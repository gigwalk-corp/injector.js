/*! injector-js - v0.2.1 - 2015-10-15
* Copyright (c) 2015 Bigger Boat; 
*/
(function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():t.returnExports=n()})(this,function(){var t={};return t.InjectionMapping=function(t,n,i){this._type=t,this._name=n,this._id=i,this._value=null,this._toType=null,this._isValid=function(){return null!=this._value||null!=this._toType},this._validateBeforeCreation=function(){if(this._isValid())throw Error("Could not create mapping for "+this._id+" because it already has been defined");return!0}},t.InjectionMapping.prototype={toValue:function(t){this._validateBeforeCreation()&&(this._value=t)},toType:function(t){this._validateBeforeCreation()&&(this._toType=t)},toSingleton:function(t){this.toValue(new t)},getValue:function(){if(!this._isValid())throw Error("Could not get value for "+this._id+" because the mapping is invalid");return null!=this._value?this._value:null!=this._toType?new this._toType:void 0}},t.Injector=function(n){this._mappings={},this._parentInjector=null,this._createMapping=function(n,i,e){if(this._hasOwnMapping(n,i))throw Error("Already has mapping for "+n);var a=new t.InjectionMapping(n,i,e);return this._mappings[e]=a,a},this._getMappingID=function(t,n){return n=void 0==n?"":n,t+"|"+n},this._hasOwnMapping=function(t,n){var i=this._getMappingID(t,n);return void 0!==this._mappings[i]},this._postConstruct=function(t){var n,i,e,a=void 0!==t.postConstructs?t.postConstructs instanceof Array?t.postConstructs:[]:[];for(n in a)i=a[n],e=void 0===t[i]?null:t[i],"function"==typeof e&&e.apply(t)},this.map("injector").toValue(this),this._parentInjector=n||null},t.Injector.prototype={map:function(t,n){var i=this._getMappingID(t,n);return this._mappings[i]||this._createMapping(t,n,i)},unmap:function(t,n){if(!this.hasMapping(t,n)){var i=void 0==n?"":" by name "+n;throw Error('Cannot unmap "'+t+i+'" because no mapping has been found')}var e=this._getMappingID(t,n);delete this._mappings[e]},hasMapping:function(t,n){return this._hasOwnMapping(t,n)||null!==this._parentInjector&&this._parentInjector.hasMapping(t,n)},hasDirectMapping:function(t,n){return this._hasOwnMapping(t,n)},getInstance:function(t,n){if(this.hasMapping(t,n))return this.getMapping(t,n).getValue();var i=void 0==n?"":" by name "+n;throw Error('Cannot return instance "'+t+i+'" because no mapping has been found')},getMapping:function(t,n){if(this.hasMapping(t,n)){var i=this._getMappingID(t,n);return void 0!==this._mappings[i]?this._mappings[i]:this.getParentInjector().getMapping(t,n)}var e=void 0==n?"":" by name "+n;throw Error('Mapping "'+t+e+'" was not found')},injectInto:function(n){var i,e;for(i in n)if(e=t.utils.stringToObject(i,n[i]),null!=e){if(!this.hasMapping(e.type,e.name))throw Error("Cannot inject "+e.type+" into "+n+" due to a missing rule");n[i]=this.getInstance(e.type,e.name)}this._postConstruct(n)},teardown:function(){this._mappings={},this.map("injector").toValue(this)},getParentInjector:function(){return this._parentInjector},setParentInjector:function(n){if(null!=n&&!(n instanceof t.Injector))throw Error("Cannot set the parentInjector because it is not an injector");this._parentInjector=n},createChildInjector:function(){return new t.Injector(this)}},t.utils={},t.utils.stringToObject=function(t,n){if("string"!=typeof n)return null;var i,e,a={name:"",type:t},o=RegExp("^inject"),r=RegExp(/[\w:\-]?name[\s]*?=[\s]*?("[^"]+"|'[^']+'|\w+)/),s=RegExp(":[^:]+$");return"inject"==n?a:n.match(o)?(i=r.exec(n),e=s.exec(n),a.name=null!=i&&2==i.length?i[1].replace(/"/gm,""):"",a.type=null!=e&&1==e.length?e[0].replace(":",""):t,a):null},t});